<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: modules/mercado.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: modules/mercado.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * @file mercado.js
 * @description Gestiona la visualización de productos, la lógica de compra y la animación de confirmación.
 */

import { mostrarPerfil } from '../script.js';
import { PRODUCTOS_MERCADO } from './constants.js';

/**
 * @function animarIconoCompra
 * @description Crea y anima un icono de verificación en la posición donde el usuario hizo clic.
 * @param {MouseEvent} evento - El evento del clic para obtener las coordenadas.
 */
// animacion de compra
function animarIconoCompra(evento) {
    const icono = document.createElement('div');
    icono.className = 'icono-compra';
    icono.innerText = '✔️'; 

    // posicionamiento del click
    icono.style.left = evento.pageX + 'px';
    icono.style.top = evento.pageY + 'px';

    document.body.appendChild(icono);

    setTimeout(() => {
        icono.remove();
    }, 1000);
}

/**
 * @function pintarProductos
 * @description Genera visualmente las tarjetas de productos disponibles en el mercado.
 */
export function pintarProductos() {
    const contenedor = document.getElementById('contenedor-productos');
    if (!contenedor) return;
    contenedor.innerHTML = "";

    PRODUCTOS_MERCADO.forEach(producto => {
        const tarjeta = document.createElement('div');
        tarjeta.className = 'tarjeta-producto';

        let nombreEstadistica = "";
        if (producto.tipo === "Arma"){
            nombreEstadistica = "Ataque";
        } else if (producto.tipo === "Armadura"){
            nombreEstadistica = "Defensa";
        } else if (producto.tipo === "Consumible"){
            nombreEstadistica = "Vida"; 
        }

        tarjeta.innerHTML = `
        &lt;img src="${producto.imagen}" alt="${producto.nombre}">
        &lt;h3>${producto.nombre}&lt;/h3>
        &lt;p class="rareza">${producto.rareza}&lt;/p>
        &lt;p class="bonus" style="color: yellow;">${nombreEstadistica}: +${producto.bonus}&lt;/p>
        &lt;p class="precio">&lt;strong>${producto.precio}&lt;/strong>€&lt;/p>
        &lt;button class="btn-add" data-id="${producto.id}">Añadir&lt;/button>
        `;

        contenedor.appendChild(tarjeta);

        const boton = tarjeta.querySelector('.btn-add');
        boton.addEventListener('click', (e) => {
            gestionarCompra(producto, tarjeta, boton, e);
        });
    });
}

/**
 * @function gestionarCompra
 * @description Maneja la lógica de añadir o quitar productos del inventario y cobrar el dinero.
 * @param {Object} producto - Datos del producto.
 * @param {HTMLElement} tarjeta - Elemento visual de la tarjeta.
 * @param {HTMLElement} boton - El botón que dispara la acción.
 * @param {MouseEvent} evento - Evento del clic para la animación.
 */
function gestionarCompra(producto, tarjeta, boton, evento) {
    const jugador = window.jugadorLogueado;
    const slots = document.querySelectorAll('.slot');

    const indice = jugador.inventario.findIndex(item => item.id === producto.id);

    if(indice === -1){
        if (jugador.dinero &lt; producto.precio){
            alert("No tienes suficiente dinero");
            return;
        }

        if (jugador.inventario.length >= 6){
            alert("Inventario lleno");
            return;
        }

        // si se compra se dispara la animacion
        animarIconoCompra(evento);

        jugador.dinero -= producto.precio;
        jugador.inventario.push(producto);

        tarjeta.classList.add('tarjeta-comprada');
        boton.textContent = "Eliminar";
        boton.style.backgroundColor = "red";

        for (let slot of slots){
            if (slot.innerHTML === ""){
                slot.innerHTML = `&lt;img src="${producto.imagen}" id="img-slot-${producto.id}" style="width:100%; height:100%; object-fit:contain;">`;
                break;
            }
        }
    } else {
        jugador.dinero += producto.precio;
        jugador.inventario.splice(indice, 1);
        
        tarjeta.classList.remove('tarjeta-comprada');
        boton.textContent = "Añadir";
        boton.style.backgroundColor = "";

        const imagenRemove = document.getElementById(`img-slot-${producto.id}`);
        if (imagenRemove){
            imagenRemove.parentElement.innerHTML = "";
        }
    }

    const displayDinero = document.getElementById('dinero-display');
    if (displayDinero) {
        displayDinero.textContent = jugador.dinero + "";
    }
}

/**
 * @function botonConfirmar
 * @description Configura el botón de confirmar compra para aplicar bonus y cambiar de escena.
 */
export function botonConfirmar (){
    const btnConfirmar = document.getElementById('btn-comprar-todo');
    if(!btnConfirmar) return;

    btnConfirmar.addEventListener('click', () =>{
        const jugador = window.jugadorLogueado;

        jugador.inventario.forEach(objeto => {
            if (objeto.tipo === "Arma") {
                jugador.atq += objeto.bonus;
            } else if (objeto.tipo === "Armadura") {
                jugador.def += objeto.bonus;
            } else if (objeto.tipo === "Consumible") {
                jugador.vida += objeto.bonus;
            }
        });

        document.getElementById('escena-2').classList.add('oculto');
        document.getElementById('escena-3').classList.remove('oculto');

        mostrarPerfil();
    });
}</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Enemigo.html">Enemigo</a></li><li><a href="Enemigo_Enemigo.html">Enemigo</a></li><li><a href="Jefe.html">Jefe</a></li><li><a href="Jefe_Enemigo.html">Enemigo</a></li><li><a href="Jefe_Jefe.html">Jefe</a></li><li><a href="Jugador.html">Jugador</a></li><li><a href="Jugador_Jugador.html">Jugador</a></li><li><a href="Producto.html">Producto</a></li><li><a href="Producto_Producto.html">Producto</a></li></ul><h3>Global</h3><ul><li><a href="global.html#LISTA_ENEMIGOS">LISTA_ENEMIGOS</a></li><li><a href="global.html#PRODUCTOS_MERCADO">PRODUCTOS_MERCADO</a></li><li><a href="global.html#actualizarInventarioVisual">actualizarInventarioVisual</a></li><li><a href="global.html#animarIconoCompra">animarIconoCompra</a></li><li><a href="global.html#botonConfirmar">botonConfirmar</a></li><li><a href="global.html#calcularPuntosRecompensa">calcularPuntosRecompensa</a></li><li><a href="global.html#comprarObjeto">comprarObjeto</a></li><li><a href="global.html#gestionarCompra">gestionarCompra</a></li><li><a href="global.html#iniciarEscenaBatalla">iniciarEscenaBatalla</a></li><li><a href="global.html#iniciarPelea">iniciarPelea</a></li><li><a href="global.html#mostrarPantallaFinal">mostrarPantallaFinal</a></li><li><a href="global.html#mostrarPerfil">mostrarPerfil</a></li><li><a href="global.html#mostrarRankingFinal">mostrarRankingFinal</a></li><li><a href="global.html#pintarInventarioRanking">pintarInventarioRanking</a></li><li><a href="global.html#pintarPreviaPerfil">pintarPreviaPerfil</a></li><li><a href="global.html#pintarProductos">pintarProductos</a></li><li><a href="global.html#puedeComprar">puedeComprar</a></li><li><a href="global.html#validarNombre">validarNombre</a></li><li><a href="global.html#validarPuntos">validarPuntos</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.5</a> on Thu Jan 15 2026 14:47:30 GMT+0100 (hora estándar de Europa central)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
