<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: modules/batalla.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: modules/batalla.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * @file batalla.js
 * @description Controla la l칩gica de los combates, las animaciones de los luchadores y el c치lculo de resultados.
 */

import { LISTA_ENEMIGOS } from './constants.js';
import { mostrarRankingFinal } from './ranking.js';

let combatesRealizados = 0;
const MAX_COMBATES = 3;

/**
 * @function actualizarInventarioVisual
 * @description Dibuja los objetos del jugador en los slots correspondientes de la escena de batalla.
 * @param {string} selectorPadre - El ID o clase del contenedor donde se encuentran los slots.
 */
function actualizarInventarioVisual(selectorPadre) {
    const jugador = window.jugadorLogueado;
    const slots = document.querySelectorAll(`${selectorPadre} .slot`);
    
    slots.forEach((slot, i) => {
        slot.innerHTML = ""; 
        if (jugador.inventario[i]) {
            slot.innerHTML = `&lt;img src="${jugador.inventario[i].imagen}" style="width:100%; height:100%; object-fit:contain; display:block;">`;
        }
    });
}

/**
 * @function iniciarEscenaBatalla
 * @description Prepara la escena previa al combate mostrando la lista de posibles enemigos.
 */
export function iniciarEscenaBatalla() {
    const contenedor = document.getElementById('contenedor-enemigos');
    const jugador = window.jugadorLogueado;

    if (!contenedor || !jugador) return;

    combatesRealizados = 0;
    actualizarInventarioVisual('#inventario-combate');

    contenedor.innerHTML = "";
    LISTA_ENEMIGOS.forEach(enemigo => {
        const carta = document.createElement('div');
        carta.className = 'carta-enemigo';
        carta.innerHTML = `
            &lt;img src="${enemigo.imagen}" alt="${enemigo.nombre}">
            &lt;h3>${enemigo.nombre}&lt;/h3>
            &lt;p>${enemigo.atq} puntos de ataque&lt;/p>
        `;
        contenedor.appendChild(carta);
    });

    const btnLuchar = document.getElementById('btn-luchar');
    if (btnLuchar) {
        btnLuchar.onclick = () => {
            document.getElementById('escena-4').classList.add('oculto');
            document.getElementById('escena-5').classList.remove('oculto');
            iniciarPelea();
        };
    }
}

/**
 * @function iniciarPelea
 * @description Ejecuta la l칩gica del combate por turnos, activa las animaciones y gestiona los puntos ganados.
 */
export function iniciarPelea() {
    const jugador = window.jugadorLogueado;
    combatesRealizados++;

    actualizarInventarioVisual('#inventario-combate-5');

    const enemigo = LISTA_ENEMIGOS[Math.floor(Math.random() * LISTA_ENEMIGOS.length)];
    
    const imgJugador = document.getElementById('img-jugador-combate');
    const imgEnemigo = document.getElementById('img-enemigo-combate');

    imgJugador.src = jugador.imagen;
    document.getElementById('nombre-jugador-combate').textContent = jugador.nombre;
    imgEnemigo.src = enemigo.imagen;
    document.getElementById('nombre-enemigo-combate').textContent = enemigo.nombre;

    // logica de animacion
    imgJugador.classList.remove('animar-entrada-jugador');
    imgEnemigo.classList.remove('animar-entrada-enemigo');
    
    void imgJugador.offsetWidth; // reinicia la animacion 

    imgJugador.classList.add('animar-entrada-jugador');
    imgEnemigo.classList.add('animar-entrada-enemigo');

    

    let vidaJ = jugador.vida;
    let vidaE = enemigo.vida;

    while (vidaJ > 0 &amp;&amp; vidaE > 0) {
        vidaJ = (vidaJ + jugador.def) - enemigo.atq;
        if (vidaJ > 0) {
            vidaE = vidaE - jugador.atq;
        }
    }

    let ganador = vidaJ > 0 ? jugador.nombre : enemigo.nombre;
    let puntos = vidaJ > 0 ? enemigo.calcularPuntosRecompensa() : 0;
    
    if (vidaJ > 0) {
        jugador.puntos += puntos; 
    }

    const boxResultado = document.getElementById('resultado-combate');
    boxResultado.classList.add('oculto'); 

    // time out
    setTimeout(() => {
        boxResultado.classList.remove('oculto');
        document.getElementById('ganador-texto').textContent = `Ganador: ${ganador}`;
        document.getElementById('puntos-ganados').textContent = `Puntos ganados: ${puntos}`;
    }, 0);

    const btnContinuar = document.getElementById('btn-continuar-ranking');
    if (btnContinuar) {
        btnContinuar.onclick = () => {
            boxResultado.classList.add('oculto');
            
            if (combatesRealizados &lt; MAX_COMBATES) {
                iniciarPelea();
            } else {
            
                document.getElementById('escena-5').classList.add('oculto');
                document.getElementById('escena-6').classList.remove('oculto');
                
                mostrarPantallaFinal(); 

                // confeti
                if (jugador.puntos >= 300) {
                    confetti({
                        particleCount: 150,
                        spread: 70,
                        origin: { y: 0.6 },
                        zIndex: 999
                    });
                }
            }
        };
    }
}

/**
 * @function mostrarPantallaFinal
 * @description Muestra el resumen de puntos y el rango alcanzado (PRO o Rookie) antes del ranking.
 */
function mostrarPantallaFinal() {
    const jugador = window.jugadorLogueado;
    const rangoTexto = document.getElementById('rango-final');
    const puntosDisplay = document.getElementById('puntos-finales-display');

    puntosDisplay.textContent = jugador.puntos;

    if (jugador.puntos >= 300) {
        rangoTexto.textContent = "El Jugador ha logrado ser un PRO";
    } else {
        rangoTexto.textContent = "El Jugador ha resultado ser un Rookie";
    }

    actualizarInventarioVisual('#inventario-final');

    const btnVerClasificacion = document.getElementById('btn-ver-ranking');
    if (btnVerClasificacion) {
        btnVerClasificacion.onclick = () => {
            document.getElementById('escena-6').classList.add('oculto');
            document.getElementById('escena-7').classList.remove('oculto');
            mostrarRankingFinal(); 
        };
    }
}</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Enemigo.html">Enemigo</a></li><li><a href="Enemigo_Enemigo.html">Enemigo</a></li><li><a href="Jefe.html">Jefe</a></li><li><a href="Jefe_Enemigo.html">Enemigo</a></li><li><a href="Jefe_Jefe.html">Jefe</a></li><li><a href="Jugador.html">Jugador</a></li><li><a href="Jugador_Jugador.html">Jugador</a></li><li><a href="Producto.html">Producto</a></li><li><a href="Producto_Producto.html">Producto</a></li></ul><h3>Global</h3><ul><li><a href="global.html#LISTA_ENEMIGOS">LISTA_ENEMIGOS</a></li><li><a href="global.html#PRODUCTOS_MERCADO">PRODUCTOS_MERCADO</a></li><li><a href="global.html#actualizarInventarioVisual">actualizarInventarioVisual</a></li><li><a href="global.html#animarIconoCompra">animarIconoCompra</a></li><li><a href="global.html#botonConfirmar">botonConfirmar</a></li><li><a href="global.html#calcularPuntosRecompensa">calcularPuntosRecompensa</a></li><li><a href="global.html#comprarObjeto">comprarObjeto</a></li><li><a href="global.html#gestionarCompra">gestionarCompra</a></li><li><a href="global.html#iniciarEscenaBatalla">iniciarEscenaBatalla</a></li><li><a href="global.html#iniciarPelea">iniciarPelea</a></li><li><a href="global.html#mostrarPantallaFinal">mostrarPantallaFinal</a></li><li><a href="global.html#mostrarPerfil">mostrarPerfil</a></li><li><a href="global.html#mostrarRankingFinal">mostrarRankingFinal</a></li><li><a href="global.html#pintarInventarioRanking">pintarInventarioRanking</a></li><li><a href="global.html#pintarPreviaPerfil">pintarPreviaPerfil</a></li><li><a href="global.html#pintarProductos">pintarProductos</a></li><li><a href="global.html#puedeComprar">puedeComprar</a></li><li><a href="global.html#validarNombre">validarNombre</a></li><li><a href="global.html#validarPuntos">validarPuntos</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.5</a> on Thu Jan 15 2026 14:47:30 GMT+0100 (hora est치ndar de Europa central)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
